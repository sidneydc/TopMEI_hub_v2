-- POLICIES RLS EXPORTADAS (MODELO CSV)
schemaname,tablename,policyname,command,roles,using_expression,with_check_expression
public,auditoria,Administradores veem toda auditoria,SELECT,{authenticated},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((up.perfil_id = p.id))) WHERE ((up.user_id = auth.uid()) AND (p.role = 'administrador'::text) AND (up.ativo = true))))",null
public,auditoria,Clientes veem auditoria de suas empresas,SELECT,{authenticated},"(empresa_id IN ( SELECT empresa.id FROM empresa WHERE (empresa.user_id = auth.uid())))",null
public,auditoria,Contadores veem auditoria de suas empresas,SELECT,{authenticated},"((EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((up.perfil_id = p.id))) WHERE ((up.user_id = auth.uid()) AND (p.role = 'contador'::text) AND (up.ativo = true)))) AND (empresa_id IN ( SELECT empresa.id FROM empresa WHERE (empresa.user_id = auth.uid()))))",null
public,auditoria,Sistema insere auditoria,INSERT,{authenticated},null,true
public,certificados_digitais,Admins can manage all certificates,ALL,{public},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((up.perfil_id = p.id))) WHERE ((up.user_id = auth.uid()) AND (p.role = 'administrador'::text) AND (up.ativo = true))))","(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((up.perfil_id = p.id))) WHERE ((up.user_id = auth.uid()) AND (p.role = 'administrador'::text) AND (up.ativo = true))))"
public,certificados_digitais,Admins can view all certificates,SELECT,{public},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((up.perfil_id = p.id))) WHERE ((up.user_id = auth.uid()) AND (p.role = 'administrador'::text) AND (up.ativo = true))))",null
public,certificados_digitais,Contadores can view certificates,SELECT,{public},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((up.perfil_id = p.id))) WHERE ((up.user_id = auth.uid()) AND (p.role = 'contador'::text) AND (up.ativo = true))))",null
public,certificados_digitais,Users can delete their own certificates,DELETE,{public},(user_id = auth.uid()),null
public,certificados_digitais,Users can insert their own certificates,INSERT,{public},null,(user_id = auth.uid())
public,certificados_digitais,Users can update their own certificates,UPDATE,{public},(user_id = auth.uid()),(user_id = auth.uid())
public,certificados_digitais,Users can view their own certificates,SELECT,{public},(user_id = auth.uid()),null
public,cobranca_plano,Admin can view all cobranca_plano,SELECT,{public},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = 'administrador'::text) AND (up.ativo = true))))",null
public,cobranca_plano,Users can view own cobranca_plano,SELECT,{public},(auth.uid() = user_id),null
public,cobranca_servicos,Admin can view all cobranca_servicos,SELECT,{public},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = 'administrador'::text) AND (up.ativo = true))))",null
public,cobranca_servicos,Users can view own cobranca_servicos,SELECT,{public},(auth.uid() = user_id),null
public,documentos,Clientes podem atualizar seus documentos pendentes,UPDATE,{authenticated},"((empresa_id IN ( SELECT empresa.id FROM empresa WHERE (empresa.user_id = auth.uid()))) AND ((status)::text = 'aguardando_aprovacao'::text))","(empresa_id IN ( SELECT empresa.id FROM empresa WHERE (empresa.user_id = auth.uid())))"
public,documentos,Clientes podem excluir seus documentos pendentes,DELETE,{authenticated},"((empresa_id IN ( SELECT empresa.id FROM empresa WHERE (empresa.user_id = auth.uid()))) AND ((status)::text = 'aguardando_aprovacao'::text))",null
public,documentos,Clientes podem inserir documentos,INSERT,{authenticated},null,"(empresa_id IN ( SELECT empresa.id FROM empresa WHERE ((empresa.user_id = auth.uid()) AND ((empresa.status_cadastro)::text <> 'inativo'::text))))"
public,documentos,Clientes podem ver seus documentos,SELECT,{authenticated},"((empresa_id IN ( SELECT empresa.id FROM empresa WHERE (empresa.user_id = auth.uid()))) OR (EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = ANY (ARRAY['contador'::text, 'administrador'::text]))))))",null
public,documentos,Contador and Admin can update documents,UPDATE,{public},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = ANY (ARRAY['contador'::text, 'administrador'::text])) AND (up.ativo = true))))",null
public,documentos,Contador and Admin can view all documents,SELECT,{public},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = ANY (ARRAY['contador'::text, 'administrador'::text])) AND (up.ativo = true))))",null
public,documentos,Contadores podem atualizar documentos,UPDATE,{authenticated},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = ANY (ARRAY['contador'::text, 'administrador'::text])))))","(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = ANY (ARRAY['contador'::text, 'administrador'::text])))))"
public,documentos,Users can insert documents for own empresas,INSERT,{public},null,"(EXISTS ( SELECT 1 FROM empresa WHERE ((empresa.id = documentos.empresa_id) AND (empresa.user_id = auth.uid()))))"
public,documentos,Users can view own documents,SELECT,{public},"(EXISTS ( SELECT 1 FROM empresa WHERE ((empresa.id = documentos.empresa_id) AND (empresa.user_id = auth.uid()))))",null
public,empresa,Admin can do all on empresas,ALL,{public},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = 'administrador'::text) AND (up.ativo = true))))",null
public,empresa,Contador can update empresas,UPDATE,{public},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = ANY (ARRAY['contador'::text, 'administrador'::text])) AND (up.ativo = true))))",null
public,empresa,Contador can view all empresas,SELECT,{public},"(EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = ANY (ARRAY['contador'::text, 'administrador'::text])) AND (up.ativo = true))))",null
public,empresa,Users can insert own empresa,INSERT,{public},null,(auth.uid() = user_id)
public,empresa,Users can update own empresa,UPDATE,{public},(auth.uid() = user_id),null
public,empresa,Users can view own empresa,SELECT,{public},(auth.uid() = user_id),null
public,nfse,Admins can view all nfse,SELECT,{public},(get_user_role(auth.uid()) = 'administrador'::text),null
public,nfse,Users can insert their own nfse,INSERT,{public},null,(user_id = auth.uid())
public,nfse,Users can update their own nfse,UPDATE,{public},(user_id = auth.uid()),(user_id = auth.uid())
public,nfse,Users can view their own nfse,SELECT,{public},(user_id = auth.uid()),null
public,notificacao,Sistema pode inserir notificacoes,INSERT,{authenticated},null,true
public,notificacao,Usuarios podem atualizar suas notificacoes,UPDATE,{authenticated},(user_id = auth.uid()),(user_id = auth.uid())
public,notificacao,Usuarios podem excluir suas notificacoes,DELETE,{authenticated},(user_id = auth.uid()),null
public,notificacao,Usuarios podem ver suas notificacoes,SELECT,{authenticated},(user_id = auth.uid()),null
public,perfil,Todos podem ver perfis,SELECT,{authenticated},(ativo = true),null
public,planos,Admin can delete planos,DELETE,{authenticated},(get_user_role(auth.uid()) = 'administrador'::text),null
public,planos,Admin can insert planos,INSERT,{authenticated},null,(get_user_role(auth.uid()) = 'administrador'::text)
public,planos,Admin can update planos,UPDATE,{authenticated},(get_user_role(auth.uid()) = 'administrador'::text),null
public,planos,Admin can view all planos,SELECT,{authenticated},(get_user_role(auth.uid()) = 'administrador'::text),null
public,planos,Anyone can view active planos,SELECT,{authenticated},(ativo = true),null
public,servicos,Admin can delete servicos,DELETE,{authenticated},(get_user_role(auth.uid()) = 'administrador'::text),null
public,servicos,Admin can insert servicos,INSERT,{authenticated},null,(get_user_role(auth.uid()) = 'administrador'::text)
public,servicos,Admin can update servicos,UPDATE,{authenticated},(get_user_role(auth.uid()) = 'administrador'::text),null
public,servicos,Admin can view all servicos,SELECT,{authenticated},(get_user_role(auth.uid()) = 'administrador'::text),null
public,servicos,Anyone can view active servicos,SELECT,{authenticated},(ativo = true),null
public,templates_orcamento,Apenas admins podem atualizar templates,UPDATE,{authenticated},"(EXISTS ( SELECT 1 FROM user_perfis WHERE ((user_perfis.user_id = auth.uid()) AND (user_perfis.perfil_id IN ( SELECT perfil.id FROM perfil WHERE ((templates_orcamento.nome)::text = 'administrador'::text))))))",null
public,templates_orcamento,Apenas admins podem deletar templates,DELETE,{authenticated},"(EXISTS ( SELECT 1 FROM user_perfis WHERE ((user_perfis.user_id = auth.uid()) AND (user_perfis.perfil_id IN ( SELECT perfil.id FROM perfil WHERE ((templates_orcamento.nome)::text = 'administrador'::text))))))",null
public,templates_orcamento,Apenas admins podem inserir templates,INSERT,{authenticated},null,"(EXISTS ( SELECT 1 FROM user_perfis WHERE ((user_perfis.user_id = auth.uid()) AND (user_perfis.perfil_id IN ( SELECT perfil.id FROM perfil WHERE ((templates_orcamento.nome)::text = 'administrador'::text))))))"
public,templates_orcamento,Templates sÃ£o pÃºblicos,SELECT,{public},(ativo = true),null
public,tipo_documentos,Todos podem ver tipos de documentos,SELECT,{authenticated},(ativo = true),null
public,user_perfis,Admins can update any user_perfis,UPDATE,{authenticated},(get_user_role(auth.uid()) = 'administrador'::text),null
public,user_perfis,Admins can view all user_perfis,SELECT,{authenticated},(get_user_role(auth.uid()) = 'administrador'::text),null
public,user_perfis,Users can view own perfis,SELECT,{authenticated},(auth.uid() = user_id),null
storage,objects,Admins can view all certificates,SELECT,{authenticated},((bucket_id = 'certificados'::text) AND (get_user_role(auth.uid()) = 'administrador'::text)),null
storage,objects,Authenticated users can delete certificates,DELETE,{authenticated},(bucket_id = 'certificados'::text),null
storage,objects,Authenticated users can update certificates,UPDATE,{authenticated},(bucket_id = 'certificados'::text),(bucket_id = 'certificados'::text)
storage,objects,Authenticated users can upload certificates,INSERT,{authenticated},null,(bucket_id = 'certificados'::text)
storage,objects,Authenticated users can view certificates,SELECT,{authenticated},(bucket_id = 'certificados'::text),null
storage,objects,Clientes podem atualizar documentos pendentes,UPDATE,{authenticated},"((bucket_id = 'doc_cus'::text) AND ((storage.foldername(name))[1] IN ( SELECT (empresa.id)::text AS id FROM empresa WHERE (empresa.user_id = auth.uid()))) AND (EXISTS ( SELECT 1 FROM documentos d WHERE ((d.caminho_storage = objects.name) AND ((d.status)::text = 'aguardando_aprovacao'::text)))))",null
storage,objects,Clientes podem excluir documentos pendentes,DELETE,{authenticated},"((bucket_id = 'doc_cus'::text) AND ((storage.foldername(name))[1] IN ( SELECT (empresa.id)::text AS id FROM empresa WHERE (empresa.user_id = auth.uid()))) AND (EXISTS ( SELECT 1 FROM documentos d WHERE ((d.caminho_storage = objects.name) AND ((d.status)::text = 'aguardando_aprovacao'::text)))))",null
storage,objects,Clientes podem fazer upload em suas empresas,INSERT,{authenticated},null,"((bucket_id = 'doc_cus'::text) AND ((storage.foldername(name))[1] IN ( SELECT (empresa.id)::text AS id FROM empresa WHERE ((empresa.user_id = auth.uid()) AND ((empresa.status_cadastro)::text <> 'inativo'::text)))))"
storage,objects,Contador e Admin podem excluir documentos,DELETE,{authenticated},"((bucket_id = 'doc_cus'::text) AND (EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = ANY (ARRAY['contador'::text, 'administrador'::text]))))))",null
storage,objects,Logos sÃ£o pÃºblicas,SELECT,{public},(bucket_id = 'logos'::text),null
storage,objects,Users can delete their own certificates,DELETE,{authenticated},((bucket_id = 'certificados'::text) AND ((auth.uid())::text = (storage.foldername(name))[1])),null
storage,objects,Users can update their own certificates,UPDATE,{authenticated},((bucket_id = 'certificados'::text) AND ((auth.uid())::text = (storage.foldername(name))[1])),((bucket_id = 'certificados'::text) AND ((auth.uid())::text = (storage.foldername(name))[1]))
storage,objects,Users can upload their own certificates,INSERT,{authenticated},null,((bucket_id = 'certificados'::text) AND ((auth.uid())::text = (storage.foldername(name))[1]))
storage,objects,Users can view their own certificates,SELECT,{authenticated},((bucket_id = 'certificados'::text) AND ((auth.uid())::text = (storage.foldername(name))[1])),null
storage,objects,UsuÃ¡rios podem atualizar suas logos,UPDATE,{authenticated},(bucket_id = 'logos'::text),null
storage,objects,UsuÃ¡rios podem deletar suas logos,DELETE,{authenticated},(bucket_id = 'logos'::text),null
storage,objects,UsuÃ¡rios podem fazer upload de logos,INSERT,{authenticated},null,(bucket_id = 'logos'::text)
storage,objects,Ver documentos das prÃ³prias empresas,SELECT,{authenticated},"((bucket_id = 'doc_cus'::text) AND (((storage.foldername(name))[1] IN ( SELECT (empresa.id)::text AS id FROM empresa WHERE (empresa.user_id = auth.uid()))) OR (EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = 'contador'::text)))) OR (EXISTS ( SELECT 1 FROM (user_perfis up JOIN perfil p ON ((p.id = up.perfil_id))) WHERE ((up.user_id = auth.uid()) AND (p.role = 'administrador'::text))))))",null
